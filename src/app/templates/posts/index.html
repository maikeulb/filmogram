{% extends "base.html" %}

{% block app_content %}
<main class="mui--text-center">
<h1 class="uk-heading-line"><span>Photos</span></h1>
  <div>
    {% include 'posts/_posts.html' %}
    {% if next_url %}
      <a class="npage" hidden href={{ next_url or "#" }}>next_url</a>
    {% endif %}
  </div>
</main>

{% endblock %}

{% block js %}

<script type="text/javascript">
  $(document).ready(function () {
    var csrf_token = "{{ csrf_token() }}";
    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
          xhr.setRequestHeader("X-CSRFToken", csrf_token);
        }
      }
    });
  });
</script>

<script>
  $('.container').infiniteScroll({
    path: '.npage',
    append: '.post-item'
  });
</script>

<script>
  $(document).ready(function () {
    $('form[name="comment"]').on("submit", main);
    var form;
    var postId;
    function main (e) {
      e.preventDefault();
      form = $(e.target)
      postId = form.data("post-id");
      addComment(postId, done, fail);
    };
     function done(data) {
       $(".comments [data-post-id=" + postId +"] > ul").append(
          "<li> \
             <a class='user-comment uk-link-text' href='/user/" + data.author +
             "'>" + data.author + "</a> \
            <span style='padding-left:10px'>" + data.body + "</span> \
          </li>"
       );
    };
     function fail() {
        alert("Something failed");
    };
    function addComment(postId, done, fail) {
      $.ajax({
         url: "/api/comment/" + postId,
         method: "POST",
         data: form.serialize(),
       })
         .done(done)
         .fail(fail);
    };
  });
</script>
{% endblock %}
