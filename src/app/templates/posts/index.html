{% extends "base.html" %}

{% block app_content %}
<main class="mui--text-center">
<h1 class="uk-heading-line"><span>Photos</span></h1>
  <div>
    {% include 'posts/_posts.html' %}
    {% if next_url %}
      <a class="npage" hidden href={{ next_url or "#" }}>next_url</a>
    {% endif %}
  </div>
</main>

{% endblock %}

{% block js %}
<script>
  $('.container').infiniteScroll({
    path: '.npage',
    append: '.post-item'
  });
</script>

<script>
  $(document).ready(function () {
    $("#posts").on("click","#like-post", likePost);
    function likePost (e) {
      e.preventDefault();
      var button = $(e.target);
      var postId = button.data("post-id");
      likePostCall(postId);
    };
    function likePostCall(postId) {
      $.ajax({
         url: "/api/like/" + postId,
         method: "GET",
         success: function (data) {
           $("#likes[data-post-id=" + postId +"]").append(" " + data.data);
         },
         error: function(xhr, ajaxOptions, thrownError){
          alert('not_cool') 
         },
      });
    }
  });
</script>

<script>
  $(document).ready(function () {
    $("#posts").on("click","#unlike-post", unlikePost);
    function unlikePost (e) {
      e.preventDefault();
      var button = $(e.target);
      var postId = button.data("post-id");
      unlikePostCall(postId);
    };
    function unlikePostCall(postId) {
      $.ajax({
         url: "/api/unlike/" + postId,
         method: "GET",
         success: function (data) {
          alert('cool') 
           $("#likes[data-post-id=" + postId +"]").remove(data.data);
         },
         error: function(xhr, ajaxOptions, thrownError){
          alert('not_cool') 
         },
      });
    }
  });
</script>
{% endblock %}
